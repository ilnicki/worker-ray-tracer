!function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=5)}([function(t,e,r){"use strict";r.d(e,"g",function(){return n}),r.d(e,"d",function(){return o}),r.d(e,"f",function(){return c}),r.d(e,"b",function(){return i}),r.d(e,"c",function(){return u}),r.d(e,"e",function(){return s}),r.d(e,"a",function(){return a});const n=(t,e)=>({x:t*e.x,y:t*e.y,z:t*e.z}),o=(t,e)=>({x:t.x-e.x,y:t.y-e.y,z:t.z-e.z}),c=(t,e)=>({x:t.x+e.x,y:t.y+e.y,z:t.z+e.z}),i=(t,e)=>t.x*e.x+t.y*e.y+t.z*e.z,u=t=>Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z),s=t=>{const e=u(t);return n(0===e?1/0:1/e,t)},a=(t,e)=>({x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x})},function(t,e,r){"use strict";r.d(e,"j",function(){return n}),r.d(e,"e",function(){return o}),r.d(e,"b",function(){return c}),r.d(e,"a",function(){return i}),r.d(e,"c",function(){return u}),r.d(e,"g",function(){return s}),r.d(e,"f",function(){return a}),r.d(e,"h",function(){return d}),r.d(e,"i",function(){return l}),r.d(e,"d",function(){return f});const n={r:1,g:1,b:1},o={r:.5,g:.5,b:.5},c={r:0,g:0,b:0},i=c,u=c,s=(t,e)=>({r:t*e.r,g:t*e.g,b:t*e.b}),a=(t,e)=>({r:t.r+e.r,g:t.g+e.g,b:t.b+e.b}),d=(t,e)=>({r:t.r*e.r,g:t.g*e.g,b:t.b*e.b}),l=t=>({r:Math.floor(255*Math.min(1,t.r)),g:Math.floor(255*Math.min(1,t.g)),b:Math.floor(255*Math.min(1,t.b))}),f=t=>(t=>({r:(t>>16&255)/255,g:(t>>8&255)/255,b:(255&t)/255}))(parseInt(t,16))},function(t,e,r){"use strict";r.d(e,"a",function(){return o}),r.d(e,"b",function(){return c});var n=r(0);const o=(t,e,r)=>({handlerId:"sphere",surfaceId:r,center:t,radius2:Math.pow(e,2)}),c={intersect(t,e){const r=Object(n.d)(e.center,t.start),o=Object(n.b)(r,t.dir);let c=0;if(o>=0){const t=e.radius2-(Object(n.b)(r,r)-o*o);t>=0&&(c=o-Math.sqrt(t))}return 0!==c?{body:e,ray:t,dist:c}:null},normal:(t,e)=>Object(n.e)(Object(n.d)(t,e.center))}},function(t,e,r){"use strict";r.d(e,"a",function(){return o}),r.d(e,"b",function(){return c});var n=r(0);const o=(t,e,r)=>({handlerId:"plane",surfaceId:r,norm:t,offset:e}),c={intersect(t,e){const r=Object(n.b)(e.norm,t.dir);if(r>0)return null;return{body:e,ray:t,dist:(Object(n.b)(e.norm,t.start)+e.offset)/-r}},normal:(t,e)=>e.norm}},,function(t,e,r){"use strict";r.r(e);class n{constructor(){this.items=new Array(16)}enqueue(t){this.items.push(t)}dequeue(){return this.items.shift()||[]}}var o=r(0);const c={x:0,y:-1,z:0};var i=r(1),u=r(3),s=r(2);class a{constructor(){this.worker=new Worker("worker.bundle.js")}setScene(t){return new Promise(e=>{this.worker.postMessage({scene:t}),this.worker.addEventListener("message",()=>e(null),{once:!0})})}setCamera(t){return new Promise(e=>{this.worker.postMessage({camera:t}),this.worker.addEventListener("message",()=>e(null),{once:!0})})}traceRect(t){return new Promise(e=>{this.worker.postMessage({rect:t}),this.worker.addEventListener("message",({data:t})=>e(t),{once:!0})})}}class d{constructor(t){this.pool=Array(t).fill(null).map(()=>new a)}setScene(t){return Promise.all(this.pool.map(e=>e.setScene(t))).then(()=>null)}setCamera(t){return this.camera=t,Promise.all(this.pool.map(e=>e.setCamera(t))).then(()=>null)}trace(){return Promise.all(this.pool.map((t,e,{length:r})=>t.traceRect({x:0,y:Math.floor(this.camera.height/r*e),w:this.camera.width,h:Math.ceil(this.camera.height/r)})))}}var l=function(t,e,r,n){return new(r||(r=Promise))(function(o,c){function i(t){try{s(n.next(t))}catch(t){c(t)}}function u(t){try{s(n.throw(t))}catch(t){c(t)}}function s(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(i,u)}s((n=n.apply(t,e||[])).next())})};const f=4,h=3,b=5,y={x:-1,y:.5,z:0},m=(t,e,r)=>((t,e,r,n)=>{const i=Object(o.e)(Object(o.d)(e,t)),u=Object(o.g)(1.5,Object(o.e)(Object(o.a)(i,c)));return{pos:t,forward:i,right:u,up:Object(o.g)(1.5,Object(o.e)(Object(o.a)(i,u))),width:r,height:n}})({x:Math.cos(r)*(f-y.x)-Math.sin(r)*(b-y.z)+y.x,y:h,z:Math.sin(r)*(f-y.x)+Math.cos(r)*(b-y.z)+y.z},y,t,e);document.body.onload=(()=>l(void 0,void 0,void 0,function*(){const t=document.getElementById("canvas");if(!t.getContext)throw new Error("Application can not be drawn.");{const e=t.getContext("2d"),r=new d(4),o=new n,c=()=>window.requestAnimationFrame(()=>{o.dequeue().forEach(({position:{x:t,y:r},image:n})=>{e.putImageData(n,t,r)}),c()});setTimeout(c,3e3);const a=(()=>({bodies:[Object(u.a)({x:0,y:1,z:0},0,"checkerboard"),Object(s.a)({x:0,y:1,z:-.25},1,"shiny"),Object(s.a)({x:-1,y:.5,z:1.5},.5,"shiny"),Object(s.a)({x:-4,y:.7,z:-1.5},.7,"matt")],lights:[{pos:{x:-2,y:2.5,z:0},color:Object(i.d)("7d1212")},{pos:{x:1.5,y:2.5,z:1.5},color:Object(i.d)("12127d")},{pos:{x:1.5,y:2.5,z:-1.5},color:Object(i.d)("127d12")},{pos:{x:0,y:3.5,z:0},color:Object(i.d)("363659")}]}))();yield r.setScene(a);for(let e=0;e<10;e+=.01){const n=m(t.width,t.height,e);yield r.setCamera(n),yield r.trace().then(t=>o.enqueue(t))}}}))}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL3RyYWNlci92ZWN0b3IudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3RyYWNlci9jb2xvci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvdHJhY2VyL3NwaGVyZS50cyIsIndlYnBhY2s6Ly8vLi9zcmMvdHJhY2VyL3BsYW5lLnRzIiwid2VicGFjazovLy8uL3NyYy9hbmltYXRpb24vZnJhbWUtcXVldWUudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3RyYWNlci9jYW1lcmEudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3dvcmtlci93b3JrZXItY29udHJvbGxlci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvd29ya2VyL3dvcmtlci1tYW5hZ2VyLnRzIiwid2VicGFjazovLy8uL3NyYy9tYWluLnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiX193ZWJwYWNrX2V4cG9ydHNfXyIsInRpbWVzIiwibWludXMiLCJwbHVzIiwiZG90IiwibWFnIiwibm9ybSIsImNyb3NzIiwiayIsInYiLCJ4IiwieSIsInoiLCJ2MSIsInYyIiwiTWF0aCIsInNxcnQiLCJ2bWFnIiwiSW5maW5pdHkiLCJ3aGl0ZSIsImdyZXkiLCJibGFjayIsImJhY2tncm91bmQiLCJkZWZhdWx0Q29sb3IiLCJzY2FsZSIsInRvRHJhd2luZ0NvbG9yIiwiZnJvbUhleCIsImciLCJiIiwiZmxvb3IiLCJtaW4iLCJoZXgiLCJudW0iLCJmcm9tTnVtYmVyIiwicGFyc2VJbnQiLCJtYWtlU3BoZXJlIiwic3BoZXJlSGFuZGxlciIsIl92ZWN0b3JfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfXyIsImNlbnRlciIsInJhZGl1cyIsInN1cmZhY2VJZCIsImhhbmRsZXJJZCIsInJhZGl1czIiLCJwb3ciLCJbb2JqZWN0IE9iamVjdF0iLCJyYXkiLCJzcGhlcmUiLCJlbyIsInN0YXJ0IiwiZGlyIiwiZGlzdCIsImRpc2MiLCJib2R5Iiwibm9ybWFsIiwicG9zIiwibWFrZVBsYW5lIiwicGxhbmVIYW5kbGVyIiwib2Zmc2V0IiwicGxhbmUiLCJkZW5vbSIsIl9wb3MiLCJGcmFtZVF1ZXVlIiwidGhpcyIsIml0ZW1zIiwiQXJyYXkiLCJmcmFtZSIsInB1c2giLCJzaGlmdCIsImRvd24iLCJXb3JrZXJDb250cm9sbGVyIiwid29ya2VyIiwiV29ya2VyIiwic2NlbmUiLCJQcm9taXNlIiwicmVzb2x2ZSIsInBvc3RNZXNzYWdlIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9uY2UiLCJjYW1lcmEiLCJyZWN0IiwiZGF0YSIsIndvcmtlcl9tYW5hZ2VyX1dvcmtlck1hbmFnZXIiLCJjb3VudCIsInBvb2wiLCJmaWxsIiwibWFwIiwiYWxsIiwid2MiLCJzZXRTY2VuZSIsInRoZW4iLCJzZXRDYW1lcmEiLCJpZCIsImxlbmd0aCIsInRyYWNlUmVjdCIsImhlaWdodCIsInciLCJ3aWR0aCIsImgiLCJjZWlsIiwiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwiYXBwbHkiLCJtYWluX3BvcyIsInRnIiwibWFrZURlZmF1bHRDYW1lcmEiLCJhbmdsZSIsImxvb2tBdCIsImZvcndhcmQiLCJ2ZWN0b3IiLCJyaWdodCIsInVwIiwibWFrZUNhbWVyYSIsImNvcyIsInNpbiIsImRvY3VtZW50Iiwib25sb2FkIiwidW5kZWZpbmVkIiwiY2FudmFzIiwiZ2V0RWxlbWVudEJ5SWQiLCJnZXRDb250ZXh0IiwiRXJyb3IiLCJjdHgiLCJtYW5hZ2VyIiwicXVldWUiLCJ0cnlkcmF3Iiwid2luZG93IiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwiZGVxdWV1ZSIsImZvckVhY2giLCJwb3NpdGlvbiIsImltYWdlIiwicHV0SW1hZ2VEYXRhIiwic2V0VGltZW91dCIsImJvZGllcyIsImxpZ2h0cyIsImNvbG9yIiwibWFrZURlZmF1bHRTY2VuZSIsInRyYWNlIiwiZW5xdWV1ZSJdLCJtYXBwaW5ncyI6ImFBQ0EsSUFBQUEsRUFBQSxHQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYsRUFBQUUsR0FDQSxPQUFBRixFQUFBRSxHQUFBQyxRQUdBLElBQUFDLEVBQUFKLEVBQUFFLEdBQUEsQ0FDQUcsRUFBQUgsRUFDQUksR0FBQSxFQUNBSCxRQUFBLElBVUEsT0FOQUksRUFBQUwsR0FBQU0sS0FBQUosRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUYsR0FHQUcsRUFBQUUsR0FBQSxFQUdBRixFQUFBRCxRQUtBRixFQUFBUSxFQUFBRixFQUdBTixFQUFBUyxFQUFBVixFQUdBQyxFQUFBVSxFQUFBLFNBQUFSLEVBQUFTLEVBQUFDLEdBQ0FaLEVBQUFhLEVBQUFYLEVBQUFTLElBQ0FHLE9BQUFDLGVBQUFiLEVBQUFTLEVBQUEsQ0FBMENLLFlBQUEsRUFBQUMsSUFBQUwsS0FLMUNaLEVBQUFrQixFQUFBLFNBQUFoQixHQUNBLG9CQUFBaUIsZUFBQUMsYUFDQU4sT0FBQUMsZUFBQWIsRUFBQWlCLE9BQUFDLFlBQUEsQ0FBd0RDLE1BQUEsV0FFeERQLE9BQUFDLGVBQUFiLEVBQUEsY0FBaURtQixPQUFBLEtBUWpEckIsRUFBQXNCLEVBQUEsU0FBQUQsRUFBQUUsR0FFQSxHQURBLEVBQUFBLElBQUFGLEVBQUFyQixFQUFBcUIsSUFDQSxFQUFBRSxFQUFBLE9BQUFGLEVBQ0EsS0FBQUUsR0FBQSxpQkFBQUYsUUFBQUcsV0FBQSxPQUFBSCxFQUNBLElBQUFJLEVBQUFYLE9BQUFZLE9BQUEsTUFHQSxHQUZBMUIsRUFBQWtCLEVBQUFPLEdBQ0FYLE9BQUFDLGVBQUFVLEVBQUEsV0FBeUNULFlBQUEsRUFBQUssVUFDekMsRUFBQUUsR0FBQSxpQkFBQUYsRUFBQSxRQUFBTSxLQUFBTixFQUFBckIsRUFBQVUsRUFBQWUsRUFBQUUsRUFBQSxTQUFBQSxHQUFnSCxPQUFBTixFQUFBTSxJQUFxQkMsS0FBQSxLQUFBRCxJQUNySSxPQUFBRixHQUlBekIsRUFBQTZCLEVBQUEsU0FBQTFCLEdBQ0EsSUFBQVMsRUFBQVQsS0FBQXFCLFdBQ0EsV0FBMkIsT0FBQXJCLEVBQUEsU0FDM0IsV0FBaUMsT0FBQUEsR0FFakMsT0FEQUgsRUFBQVUsRUFBQUUsRUFBQSxJQUFBQSxHQUNBQSxHQUlBWixFQUFBYSxFQUFBLFNBQUFpQixFQUFBQyxHQUFzRCxPQUFBakIsT0FBQWtCLFVBQUFDLGVBQUExQixLQUFBdUIsRUFBQUMsSUFHdEQvQixFQUFBa0MsRUFBQSxHQUlBbEMsSUFBQW1DLEVBQUEsa0NDbEZBbkMsRUFBQVUsRUFBQTBCLEVBQUEsc0JBQUFDLElBQUFyQyxFQUFBVSxFQUFBMEIsRUFBQSxzQkFBQUUsSUFBQXRDLEVBQUFVLEVBQUEwQixFQUFBLHNCQUFBRyxJQUFBdkMsRUFBQVUsRUFBQTBCLEVBQUEsc0JBQUFJLElBQUF4QyxFQUFBVSxFQUFBMEIsRUFBQSxzQkFBQUssSUFBQXpDLEVBQUFVLEVBQUEwQixFQUFBLHNCQUFBTSxJQUFBMUMsRUFBQVUsRUFBQTBCLEVBQUEsc0JBQUFPLElBQU8sTUFBQU4sRUFBQSxDQUFBTyxFQUFBQyxLQUFBLENBQ1BDLEVBQUFGLEVBQUFDLEVBQUFDLEVBQ0FDLEVBQUFILEVBQUFDLEVBQUFFLEVBQ0FDLEVBQUFKLEVBQUFDLEVBQUFHLElBRU9WLEVBQUEsQ0FBQVcsRUFBQUMsS0FBQSxDQUNQSixFQUFBRyxFQUFBSCxFQUFBSSxFQUFBSixFQUNBQyxFQUFBRSxFQUFBRixFQUFBRyxFQUFBSCxFQUNBQyxFQUFBQyxFQUFBRCxFQUFBRSxFQUFBRixJQUVPVCxFQUFBLENBQUFVLEVBQUFDLEtBQUEsQ0FDUEosRUFBQUcsRUFBQUgsRUFBQUksRUFBQUosRUFDQUMsRUFBQUUsRUFBQUYsRUFBQUcsRUFBQUgsRUFDQUMsRUFBQUMsRUFBQUQsRUFBQUUsRUFBQUYsSUFFT1IsRUFBQSxDQUFBUyxFQUFBQyxJQUFBRCxFQUFBSCxFQUFBSSxFQUFBSixFQUFBRyxFQUFBRixFQUFBRyxFQUFBSCxFQUFBRSxFQUFBRCxFQUFBRSxFQUFBRixFQUNBUCxFQUFBSSxHQUFBTSxLQUFBQyxLQUFBUCxFQUFBQyxFQUFBRCxFQUFBQyxFQUFBRCxFQUFBRSxFQUFBRixFQUFBRSxFQUFBRixFQUFBRyxFQUFBSCxFQUFBRyxHQUNBTixFQUFBRyxJQUNQLE1BQUFRLEVBQUFaLEVBQUFJLEdBQ0EsT0FBQVIsRUFBQSxJQUFBZ0IsRUFBQUMsSUFBQSxFQUFBRCxFQUFBUixJQUVPRixFQUFBLENBQUFNLEVBQUFDLEtBQUEsQ0FDUEosRUFBQUcsRUFBQUYsRUFBQUcsRUFBQUYsRUFBQUMsRUFBQUQsRUFBQUUsRUFBQUgsRUFDQUEsRUFBQUUsRUFBQUQsRUFBQUUsRUFBQUosRUFBQUcsRUFBQUgsRUFBQUksRUFBQUYsRUFDQUEsRUFBQUMsRUFBQUgsRUFBQUksRUFBQUgsRUFBQUUsRUFBQUYsRUFBQUcsRUFBQUosa0NDeEJBOUMsRUFBQVUsRUFBQTBCLEVBQUEsc0JBQUFtQixJQUFBdkQsRUFBQVUsRUFBQTBCLEVBQUEsc0JBQUFvQixJQUFBeEQsRUFBQVUsRUFBQTBCLEVBQUEsc0JBQUFxQixJQUFBekQsRUFBQVUsRUFBQTBCLEVBQUEsc0JBQUFzQixJQUFBMUQsRUFBQVUsRUFBQTBCLEVBQUEsc0JBQUF1QixJQUFBM0QsRUFBQVUsRUFBQTBCLEVBQUEsc0JBQUF3QixJQUFBNUQsRUFBQVUsRUFBQTBCLEVBQUEsc0JB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QUFTLENBQUVnQyxFQUFBLEVBQUFDLEVBQUEsRUFBQUMsRUFBQSxHQUF5QixrQkFDcENsQyxPQUFBb0UsRUFBQSxFQUFBcEUsQ0FBVSxDQUFFZ0MsRUFBQSxFQUFBQyxFQUFBLEVBQUFDLEdBQUEsS0FBMkIsV0FDdkNsQyxPQUFBb0UsRUFBQSxFQUFBcEUsQ0FBVSxDQUFFZ0MsR0FBQSxFQUFBQyxFQUFBLEdBQUFDLEVBQUEsS0FBMEIsWUFDdENsQyxPQUFBb0UsRUFBQSxFQUFBcEUsQ0FBVSxDQUFFZ0MsR0FBQSxFQUFBQyxFQUFBLEdBQUFDLEdBQUEsS0FBeUIsWUFFN0NxSSxPQUFBLENBQ0EsQ0FBUzNGLElBQUEsQ0FBTzVDLEdBQUEsRUFBQUMsRUFBQSxJQUFBQyxFQUFBLEdBQTBCc0ksTUFBU3hLLE9BQUF3SyxFQUFBLEVBQUF4SyxDQUFPLFdBQzFELENBQVM0RSxJQUFBLENBQU81QyxFQUFBLElBQUFDLEVBQUEsSUFBQUMsRUFBQSxLQUF5QnNJLE1BQVN4SyxPQUFBd0ssRUFBQSxFQUFBeEssQ0FBTyxXQUN6RCxDQUFTNEUsSUFBQSxDQUFPNUMsRUFBQSxJQUFBQyxFQUFBLElBQUFDLEdBQUEsS0FBMEJzSSxNQUFTeEssT0FBQXdLLEVBQUEsRUFBQXhLLENBQU8sV0FDMUQsQ0FBUzRFLElBQUEsQ0FBTzVDLEVBQUEsRUFBQUMsRUFBQSxJQUFBQyxFQUFBLEdBQXlCc0ksTUFBU3hLLE9BQUF3SyxFQUFBLEVBQUF4SyxDQUFPLGNBdUJ6RHlLLFNBQ0FkLEVBQUE3QyxTQUFBaEIsR0FDQSxRQUFBOUQsRUFBQSxFQUF1QkEsRUFBQSxHQUFRQSxHQUFBLEtBQy9CLE1BQUFvRSxFQUFBcUMsRUFBQWEsRUFBQWhDLE1BQUFnQyxFQUFBbEMsT0FBQXBGLFNBQ0EySCxFQUFBM0MsVUFBQVosU0FDQXVELEVBQUFlLFFBQUEzRCxLQUFBeEIsR0FBQXFFLEVBQUFlLFFBQUFwRiIsImZpbGUiOiJtYWluLmJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSA1KTtcbiIsImV4cG9ydCBjb25zdCB0aW1lcyA9IChrLCB2KSA9PiAoe1xuICAgIHg6IGsgKiB2LngsXG4gICAgeTogayAqIHYueSxcbiAgICB6OiBrICogdi56LFxufSk7XG5leHBvcnQgY29uc3QgbWludXMgPSAodjEsIHYyKSA9PiAoe1xuICAgIHg6IHYxLnggLSB2Mi54LFxuICAgIHk6IHYxLnkgLSB2Mi55LFxuICAgIHo6IHYxLnogLSB2Mi56LFxufSk7XG5leHBvcnQgY29uc3QgcGx1cyA9ICh2MSwgdjIpID0+ICh7XG4gICAgeDogdjEueCArIHYyLngsXG4gICAgeTogdjEueSArIHYyLnksXG4gICAgejogdjEueiArIHYyLnosXG59KTtcbmV4cG9ydCBjb25zdCBkb3QgPSAodjEsIHYyKSA9PiB2MS54ICogdjIueCArIHYxLnkgKiB2Mi55ICsgdjEueiAqIHYyLno7XG5leHBvcnQgY29uc3QgbWFnID0gKHYpID0+IE1hdGguc3FydCh2LnggKiB2LnggKyB2LnkgKiB2LnkgKyB2LnogKiB2LnopO1xuZXhwb3J0IGNvbnN0IG5vcm0gPSAodikgPT4ge1xuICAgIGNvbnN0IHZtYWcgPSBtYWcodik7XG4gICAgcmV0dXJuIHRpbWVzKCh2bWFnID09PSAwKSA/IEluZmluaXR5IDogMS4wIC8gdm1hZywgdik7XG59O1xuZXhwb3J0IGNvbnN0IGNyb3NzID0gKHYxLCB2MikgPT4gKHtcbiAgICB4OiB2MS55ICogdjIueiAtIHYxLnogKiB2Mi55LFxuICAgIHk6IHYxLnogKiB2Mi54IC0gdjEueCAqIHYyLnosXG4gICAgejogdjEueCAqIHYyLnkgLSB2MS55ICogdjIueCxcbn0pO1xuIiwiZXhwb3J0IGNvbnN0IHdoaXRlID0geyByOiAxLjAsIGc6IDEuMCwgYjogMS4wIH07XG5leHBvcnQgY29uc3QgZ3JleSA9IHsgcjogMC41LCBnOiAwLjUsIGI6IDAuNSB9O1xuZXhwb3J0IGNvbnN0IGJsYWNrID0geyByOiAwLjAsIGc6IDAuMCwgYjogMC4wIH07XG5leHBvcnQgY29uc3QgYmFja2dyb3VuZCA9IGJsYWNrO1xuZXhwb3J0IGNvbnN0IGRlZmF1bHRDb2xvciA9IGJsYWNrO1xuZXhwb3J0IGNvbnN0IHNjYWxlID0gKGssIHYpID0+ICh7IHI6IGsgKiB2LnIsIGc6IGsgKiB2LmcsIGI6IGsgKiB2LmIgfSk7XG5leHBvcnQgY29uc3QgcGx1cyA9ICh2MSwgdjIpID0+ICh7IHI6IHYxLnIgKyB2Mi5yLCBnOiB2MS5nICsgdjIuZywgYjogdjEuYiArIHYyLmIgfSk7XG5leHBvcnQgY29uc3QgdGltZXMgPSAodjEsIHYyKSA9PiAoeyByOiB2MS5yICogdjIuciwgZzogdjEuZyAqIHYyLmcsIGI6IHYxLmIgKiB2Mi5iIH0pO1xuZXhwb3J0IGNvbnN0IHRvRHJhd2luZ0NvbG9yID0gKGMpID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgICByOiBNYXRoLmZsb29yKE1hdGgubWluKDEsIGMucikgKiAyNTUpLFxuICAgICAgICBnOiBNYXRoLmZsb29yKE1hdGgubWluKDEsIGMuZykgKiAyNTUpLFxuICAgICAgICBiOiBNYXRoLmZsb29yKE1hdGgubWluKDEsIGMuYikgKiAyNTUpLFxuICAgIH07XG59O1xuZXhwb3J0IGNvbnN0IHRvU3RyaW5nID0gKGMpID0+IGByZ2IoJHtjLnJ9LCAke2MuZ30sICR7Yy5ifWA7XG5leHBvcnQgY29uc3QgZnJvbU51bWJlciA9IChudW0pID0+ICh7XG4gICAgcjogKChudW0gPj4gMTYpICYgMjU1KSAvIDI1NSxcbiAgICBnOiAoKG51bSA+PiA4KSAmIDI1NSkgLyAyNTUsXG4gICAgYjogKG51bSAmIDI1NSkgLyAyNTUsXG59KTtcbmV4cG9ydCBjb25zdCBmcm9tSGV4ID0gKGhleCkgPT4gZnJvbU51bWJlcihwYXJzZUludChoZXgsIDE2KSk7XG4iLCJpbXBvcnQgeyBkb3QsIG1pbnVzLCBub3JtIH0gZnJvbSAnLi92ZWN0b3InO1xuZXhwb3J0IGNvbnN0IG1ha2VTcGhlcmUgPSAoY2VudGVyLCByYWRpdXMsIHN1cmZhY2VJZCkgPT4gKHtcbiAgICBoYW5kbGVySWQ6ICdzcGhlcmUnLFxuICAgIHN1cmZhY2VJZCxcbiAgICBjZW50ZXIsXG4gICAgcmFkaXVzMjogTWF0aC5wb3cocmFkaXVzLCAyKSxcbn0pO1xuZXhwb3J0IGNvbnN0IHNwaGVyZUhhbmRsZXIgPSB7XG4gICAgaW50ZXJzZWN0KHJheSwgc3BoZXJlKSB7XG4gICAgICAgIGNvbnN0IGVvID0gbWludXMoc3BoZXJlLmNlbnRlciwgcmF5LnN0YXJ0KTtcbiAgICAgICAgY29uc3QgdiA9IGRvdChlbywgcmF5LmRpcik7XG4gICAgICAgIGxldCBkaXN0ID0gMDtcbiAgICAgICAgaWYgKHYgPj0gMCkge1xuICAgICAgICAgICAgY29uc3QgZGlzYyA9IHNwaGVyZS5yYWRpdXMyIC0gKGRvdChlbywgZW8pIC0gdiAqIHYpO1xuICAgICAgICAgICAgaWYgKGRpc2MgPj0gMCkge1xuICAgICAgICAgICAgICAgIGRpc3QgPSB2IC0gTWF0aC5zcXJ0KGRpc2MpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkaXN0ICE9PSAwID8geyBib2R5OiBzcGhlcmUsIHJheSwgZGlzdCB9IDogbnVsbDtcbiAgICB9LFxuICAgIG5vcm1hbDogKHBvcywgc3BoZXJlKSA9PiBub3JtKG1pbnVzKHBvcywgc3BoZXJlLmNlbnRlcikpLFxufTtcbiIsImltcG9ydCB7IGRvdCB9IGZyb20gJy4vdmVjdG9yJztcbmV4cG9ydCBjb25zdCBtYWtlUGxhbmUgPSAobm9ybSwgb2Zmc2V0LCBzdXJmYWNlSWQpID0+ICh7XG4gICAgaGFuZGxlcklkOiAncGxhbmUnLFxuICAgIHN1cmZhY2VJZCxcbiAgICBub3JtLFxuICAgIG9mZnNldCxcbn0pO1xuZXhwb3J0IGNvbnN0IHBsYW5lSGFuZGxlciA9IHtcbiAgICBpbnRlcnNlY3QocmF5LCBwbGFuZSkge1xuICAgICAgICBjb25zdCBkZW5vbSA9IGRvdChwbGFuZS5ub3JtLCByYXkuZGlyKTtcbiAgICAgICAgaWYgKGRlbm9tID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBkaXN0ID0gKGRvdChwbGFuZS5ub3JtLCByYXkuc3RhcnQpICsgcGxhbmUub2Zmc2V0KSAvICgtZGVub20pO1xuICAgICAgICAgICAgcmV0dXJuIHsgYm9keTogcGxhbmUsIHJheSwgZGlzdCB9O1xuICAgICAgICB9XG4gICAgfSxcbiAgICBub3JtYWw6IChfcG9zLCBwbGFuZSkgPT4gcGxhbmUubm9ybSxcbn07XG4iLCJleHBvcnQgY2xhc3MgRnJhbWVRdWV1ZSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuaXRlbXMgPSBuZXcgQXJyYXkoMTYpO1xuICAgIH1cbiAgICBlbnF1ZXVlKGZyYW1lKSB7XG4gICAgICAgIHRoaXMuaXRlbXMucHVzaChmcmFtZSk7XG4gICAgfVxuICAgIGRlcXVldWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLml0ZW1zLnNoaWZ0KCkgfHwgW107XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgY3Jvc3MsIG1pbnVzLCBub3JtLCB0aW1lcyB9IGZyb20gJy4vdmVjdG9yJztcbmNvbnN0IGRvd24gPSB7IHg6IDAuMCwgeTogLTEuMCwgejogMC4wIH07XG5leHBvcnQgY29uc3QgbWFrZUNhbWVyYSA9IChwb3MsIGxvb2tBdCwgd2lkdGgsIGhlaWdodCkgPT4ge1xuICAgIGNvbnN0IGZvcndhcmQgPSBub3JtKG1pbnVzKGxvb2tBdCwgcG9zKSk7XG4gICAgY29uc3QgcmlnaHQgPSB0aW1lcygxLjUsIG5vcm0oY3Jvc3MoZm9yd2FyZCwgZG93bikpKTtcbiAgICBjb25zdCB1cCA9IHRpbWVzKDEuNSwgbm9ybShjcm9zcyhmb3J3YXJkLCByaWdodCkpKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBwb3MsXG4gICAgICAgIGZvcndhcmQsXG4gICAgICAgIHJpZ2h0LFxuICAgICAgICB1cCxcbiAgICAgICAgd2lkdGgsXG4gICAgICAgIGhlaWdodCxcbiAgICB9O1xufTtcbmV4cG9ydCBjb25zdCBpdGVyYXRlID0gZnVuY3Rpb24qIChjYW1lcmEpIHtcbiAgICBmb3IgKGxldCB5ID0gMDsgeSA8IGNhbWVyYS5oZWlnaHQ7IHkrKykge1xuICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IGNhbWVyYS53aWR0aDsgeCsrKSB7XG4gICAgICAgICAgICB5aWVsZCB7IHgsIHkgfTtcbiAgICAgICAgfVxuICAgIH1cbn07XG4iLCJleHBvcnQgY2xhc3MgV29ya2VyQ29udHJvbGxlciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMud29ya2VyID0gbmV3IFdvcmtlcignd29ya2VyLmJ1bmRsZS5qcycpO1xuICAgIH1cbiAgICBzZXRTY2VuZShzY2VuZSkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICAgICAgICB0aGlzLndvcmtlci5wb3N0TWVzc2FnZSh7IHNjZW5lIH0pO1xuICAgICAgICAgICAgdGhpcy53b3JrZXIuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsICgpID0+IHJlc29sdmUobnVsbCksIHsgb25jZTogdHJ1ZSB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHNldENhbWVyYShjYW1lcmEpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgICAgICAgdGhpcy53b3JrZXIucG9zdE1lc3NhZ2UoeyBjYW1lcmEgfSk7XG4gICAgICAgICAgICB0aGlzLndvcmtlci5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgKCkgPT4gcmVzb2x2ZShudWxsKSwgeyBvbmNlOiB0cnVlIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgdHJhY2VSZWN0KHJlY3QpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgICAgICAgdGhpcy53b3JrZXIucG9zdE1lc3NhZ2UoeyByZWN0IH0pO1xuICAgICAgICAgICAgdGhpcy53b3JrZXIuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsICh7IGRhdGEgfSkgPT4gcmVzb2x2ZShkYXRhKSwgeyBvbmNlOiB0cnVlIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBXb3JrZXJDb250cm9sbGVyIH0gZnJvbSAnLi93b3JrZXItY29udHJvbGxlcic7XG5leHBvcnQgY2xhc3MgV29ya2VyTWFuYWdlciB7XG4gICAgY29uc3RydWN0b3IoY291bnQpIHtcbiAgICAgICAgdGhpcy5wb29sID0gQXJyYXkoY291bnQpLmZpbGwobnVsbCkubWFwKCgpID0+IG5ldyBXb3JrZXJDb250cm9sbGVyKCkpO1xuICAgIH1cbiAgICBzZXRTY2VuZShzY2VuZSkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwodGhpcy5wb29sLm1hcCh3YyA9PiB3Yy5zZXRTY2VuZShzY2VuZSkpKS50aGVuKCgpID0+IG51bGwpO1xuICAgIH1cbiAgICBzZXRDYW1lcmEoY2FtZXJhKSB7XG4gICAgICAgIHRoaXMuY2FtZXJhID0gY2FtZXJhO1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwodGhpcy5wb29sLm1hcCh3YyA9PiB3Yy5zZXRDYW1lcmEoY2FtZXJhKSkpLnRoZW4oKCkgPT4gbnVsbCk7XG4gICAgfVxuICAgIHRyYWNlKCkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwodGhpcy5wb29sLm1hcCgod2MsIGlkLCB7IGxlbmd0aCB9KSA9PiB3Yy50cmFjZVJlY3Qoe1xuICAgICAgICAgICAgeDogMCxcbiAgICAgICAgICAgIHk6IE1hdGguZmxvb3IodGhpcy5jYW1lcmEuaGVpZ2h0IC8gbGVuZ3RoICogaWQpLFxuICAgICAgICAgICAgdzogdGhpcy5jYW1lcmEud2lkdGgsXG4gICAgICAgICAgICBoOiBNYXRoLmNlaWwodGhpcy5jYW1lcmEuaGVpZ2h0IC8gbGVuZ3RoKSxcbiAgICAgICAgfSkpKTtcbiAgICB9XG59XG4iLCJ2YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbmltcG9ydCB7IEZyYW1lUXVldWUgfSBmcm9tICcuL2FuaW1hdGlvbi9mcmFtZS1xdWV1ZSc7XG5pbXBvcnQgeyBtYWtlQ2FtZXJhIH0gZnJvbSAnLi90cmFjZXIvY2FtZXJhJztcbmltcG9ydCB7IGZyb21IZXggfSBmcm9tICcuL3RyYWNlci9jb2xvcic7XG5pbXBvcnQgeyBtYWtlUGxhbmUgfSBmcm9tICcuL3RyYWNlci9wbGFuZSc7XG5pbXBvcnQgeyBtYWtlU3BoZXJlIH0gZnJvbSAnLi90cmFjZXIvc3BoZXJlJztcbmltcG9ydCB7IFdvcmtlck1hbmFnZXIgfSBmcm9tICcuL3dvcmtlci93b3JrZXItbWFuYWdlcic7XG5jb25zdCBtYWtlRGVmYXVsdFNjZW5lID0gKCkgPT4gKHtcbiAgICBib2RpZXM6IFtcbiAgICAgICAgbWFrZVBsYW5lKHsgeDogMC4wLCB5OiAxLjAsIHo6IDAuMCB9LCAwLjAsICdjaGVja2VyYm9hcmQnKSxcbiAgICAgICAgbWFrZVNwaGVyZSh7IHg6IDAuMCwgeTogMS4wLCB6OiAtMC4yNSB9LCAxLjAsICdzaGlueScpLFxuICAgICAgICBtYWtlU3BoZXJlKHsgeDogLTEuMCwgeTogMC41LCB6OiAxLjUgfSwgMC41LCAnc2hpbnknKSxcbiAgICAgICAgbWFrZVNwaGVyZSh7IHg6IC00LCB5OiAwLjcsIHo6IC0xLjUgfSwgMC43LCAnbWF0dCcpLFxuICAgIF0sXG4gICAgbGlnaHRzOiBbXG4gICAgICAgIHsgcG9zOiB7IHg6IC0yLjAsIHk6IDIuNSwgejogMC4wIH0sIGNvbG9yOiBmcm9tSGV4KCc3ZDEyMTInKSB9LFxuICAgICAgICB7IHBvczogeyB4OiAxLjUsIHk6IDIuNSwgejogMS41IH0sIGNvbG9yOiBmcm9tSGV4KCcxMjEyN2QnKSB9LFxuICAgICAgICB7IHBvczogeyB4OiAxLjUsIHk6IDIuNSwgejogLTEuNSB9LCBjb2xvcjogZnJvbUhleCgnMTI3ZDEyJykgfSxcbiAgICAgICAgeyBwb3M6IHsgeDogMC4wLCB5OiAzLjUsIHo6IDAuMCB9LCBjb2xvcjogZnJvbUhleCgnMzYzNjU5JykgfSxcbiAgICBdLFxufSk7XG5jb25zdCBwb3MgPSB7IHg6IDQuMCwgeTogMy4wLCB6OiA1LjAgfTtcbmNvbnN0IHRnID0geyB4OiAtMS4wLCB5OiAwLjUsIHo6IDAuMCB9O1xuY29uc3QgbWFrZURlZmF1bHRDYW1lcmEgPSAod2lkdGgsIGhlaWdodCwgYW5nbGUpID0+IG1ha2VDYW1lcmEoe1xuICAgIHg6IE1hdGguY29zKGFuZ2xlKSAqIChwb3MueCAtIHRnLngpIC0gTWF0aC5zaW4oYW5nbGUpICogKHBvcy56IC0gdGcueikgKyB0Zy54LFxuICAgIHk6IHBvcy55LFxuICAgIHo6IE1hdGguc2luKGFuZ2xlKSAqIChwb3MueCAtIHRnLngpICsgTWF0aC5jb3MoYW5nbGUpICogKHBvcy56IC0gdGcueikgKyB0Zy56LFxufSwgdGcsIHdpZHRoLCBoZWlnaHQpO1xuZG9jdW1lbnQuYm9keS5vbmxvYWQgPSAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbnZhcycpO1xuICAgIGlmIChjYW52YXMuZ2V0Q29udGV4dCkge1xuICAgICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgY29uc3QgbWFuYWdlciA9IG5ldyBXb3JrZXJNYW5hZ2VyKDQpO1xuICAgICAgICBjb25zdCBxdWV1ZSA9IG5ldyBGcmFtZVF1ZXVlKCk7XG4gICAgICAgIGNvbnN0IHRyeWRyYXcgPSAoKSA9PiB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcbiAgICAgICAgICAgIHF1ZXVlLmRlcXVldWUoKS5mb3JFYWNoKCh7IHBvc2l0aW9uOiB7IHgsIHkgfSwgaW1hZ2UgfSkgPT4ge1xuICAgICAgICAgICAgICAgIGN0eC5wdXRJbWFnZURhdGEoaW1hZ2UsIHgsIHkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0cnlkcmF3KCk7XG4gICAgICAgIH0pO1xuICAgICAgICBzZXRUaW1lb3V0KHRyeWRyYXcsIDMwMDApO1xuICAgICAgICBjb25zdCBzY2VuZSA9IG1ha2VEZWZhdWx0U2NlbmUoKTtcbiAgICAgICAgeWllbGQgbWFuYWdlci5zZXRTY2VuZShzY2VuZSk7XG4gICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgMTA7IHggKz0gMC4wMSkge1xuICAgICAgICAgICAgY29uc3QgY2FtZXJhID0gbWFrZURlZmF1bHRDYW1lcmEoY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0LCB4KTtcbiAgICAgICAgICAgIHlpZWxkIG1hbmFnZXIuc2V0Q2FtZXJhKGNhbWVyYSk7XG4gICAgICAgICAgICB5aWVsZCBtYW5hZ2VyLnRyYWNlKCkudGhlbihmcmFtZSA9PiBxdWV1ZS5lbnF1ZXVlKGZyYW1lKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQXBwbGljYXRpb24gY2FuIG5vdCBiZSBkcmF3bi4nKTtcbiAgICB9XG59KTtcbiJdLCJzb3VyY2VSb290IjoiIn0=