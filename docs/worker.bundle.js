!function(t){var e={};function r(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(n,s,function(e){return t[e]}.bind(null,s));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=4)}([function(t,e,r){"use strict";r.d(e,"g",function(){return n}),r.d(e,"d",function(){return s}),r.d(e,"f",function(){return c}),r.d(e,"b",function(){return i}),r.d(e,"c",function(){return a}),r.d(e,"e",function(){return o}),r.d(e,"a",function(){return u});const n=(t,e)=>({x:t*e.x,y:t*e.y,z:t*e.z}),s=(t,e)=>({x:t.x-e.x,y:t.y-e.y,z:t.z-e.z}),c=(t,e)=>({x:t.x+e.x,y:t.y+e.y,z:t.z+e.z}),i=(t,e)=>t.x*e.x+t.y*e.y+t.z*e.z,a=t=>Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z),o=t=>{const e=a(t);return n(0===e?1/0:1/e,t)},u=(t,e)=>({x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x})},function(t,e,r){"use strict";r.d(e,"j",function(){return n}),r.d(e,"e",function(){return s}),r.d(e,"b",function(){return c}),r.d(e,"a",function(){return i}),r.d(e,"c",function(){return a}),r.d(e,"g",function(){return o}),r.d(e,"f",function(){return u}),r.d(e,"h",function(){return d}),r.d(e,"i",function(){return f}),r.d(e,"d",function(){return h});const n={r:1,g:1,b:1},s={r:.5,g:.5,b:.5},c={r:0,g:0,b:0},i=c,a=c,o=(t,e)=>({r:t*e.r,g:t*e.g,b:t*e.b}),u=(t,e)=>({r:t.r+e.r,g:t.g+e.g,b:t.b+e.b}),d=(t,e)=>({r:t.r*e.r,g:t.g*e.g,b:t.b*e.b}),f=t=>({r:Math.floor(255*Math.min(1,t.r)),g:Math.floor(255*Math.min(1,t.g)),b:Math.floor(255*Math.min(1,t.b))}),h=t=>(t=>({r:(t>>16&255)/255,g:(t>>8&255)/255,b:(255&t)/255}))(parseInt(t,16))},function(t,e,r){"use strict";r.d(e,"a",function(){return s}),r.d(e,"b",function(){return c});var n=r(0);const s=(t,e,r)=>({handlerId:"sphere",surfaceId:r,center:t,radius2:Math.pow(e,2)}),c={intersect(t,e){const r=Object(n.d)(e.center,t.start),s=Object(n.b)(r,t.dir);let c=0;if(s>=0){const t=e.radius2-(Object(n.b)(r,r)-s*s);t>=0&&(c=s-Math.sqrt(t))}return 0!==c?{body:e,ray:t,dist:c}:null},normal:(t,e)=>Object(n.e)(Object(n.d)(t,e.center))}},function(t,e,r){"use strict";r.d(e,"a",function(){return s}),r.d(e,"b",function(){return c});var n=r(0);const s=(t,e,r)=>({handlerId:"plane",surfaceId:r,norm:t,offset:e}),c={intersect(t,e){const r=Object(n.b)(e.norm,t.dir);if(r>0)return null;return{body:e,ray:t,dist:(Object(n.b)(e.norm,t.start)+e.offset)/-r}},normal:(t,e)=>e.norm}},function(t,e,r){"use strict";r.r(e);var n=r(3),s=r(2);const c={plane:n.b,sphere:s.b};var i=r(1);const a=t=>()=>t,o={shiny:{diffuse:a(i.j),specular:a(i.e),reflect:a(.7),roughness:250},matt:{diffuse:a(i.j),specular:a(i.b),reflect:a(.01),roughness:900},checkerboard:{diffuse:t=>(Math.floor(t.z)+Math.floor(t.x))%2!=0?i.j:i.b,specular:a(i.j),reflect:t=>(Math.floor(t.z)+Math.floor(t.x))%2!=0?.1:.7,roughness:150}};var u=r(0);class d{constructor(){this.maxDepth=5,this.surfaces=o,this.bodies=c}tracePoint(t,e){return i.i(this.traceRay({start:this.scene.camera.pos,dir:this.getPoint(t,e)},0))}getPoint(t,e){return Object(u.e)(Object(u.f)(this.scene.camera.forward,Object(u.f)(Object(u.g)((t-this.scene.camera.width/2)/2/this.scene.camera.width,this.scene.camera.right),Object(u.g)(-(e-this.scene.camera.height/2)/2/this.scene.camera.height,this.scene.camera.up))))}intersections(t){return this.scene.bodies.map(e=>this.bodies[e.handlerId].intersect(t,e)).reduce((t,e)=>!t||e&&e.dist<t.dist?e:t,null)}testRay(t){const e=this.intersections(t);return e?e.dist:null}traceRay(t,e){const r=this.intersections(t);return r?this.shade(r,e):i.a}shade(t,e){const r=t.ray.dir,n=Object(u.f)(Object(u.g)(t.dist,r),t.ray.start),s=this.bodies[t.body.handlerId].normal(n,t.body),c=Object(u.d)(r,Object(u.g)(2,Object(u.g)(Object(u.b)(s,r),s))),a=i.f(i.a,this.getNaturalColor(t.body,n,s,c)),o=e>=this.maxDepth?i.e:this.getReflectionColor(t.body,n,c,e);return i.f(a,o)}getReflectionColor(t,e,r,n){return i.g(this.surfaces[t.surfaceId].reflect(e),this.traceRay({start:e,dir:r},n+1))}getNaturalColor(t,e,r,n){return this.scene.lights.reduce((s,c)=>{const a=Object(u.d)(c.pos,e),o=Object(u.e)(a),d=this.testRay({start:e,dir:o});if(!!d&&d<=Object(u.c)(a))return s;{const a=Object(u.b)(o,r),d=a>0?i.g(a,c.color):i.c,f=Object(u.b)(o,Object(u.e)(n)),h=f>0?i.g(Math.pow(f,this.surfaces[t.surfaceId].roughness),c.color):i.c;return i.f(s,i.f(i.h(this.surfaces[t.surfaceId].diffuse(e),d),i.h(this.surfaces[t.surfaceId].specular(e),h)))}},i.c)}}class f{constructor(t){this.pointer=0,this.data=t.data}append(t){this.data[this.pointer++]=t.r,this.data[this.pointer++]=t.g,this.data[this.pointer++]=t.b,this.data[this.pointer++]=255}}(new class{constructor(){this.tracer=new d}attachTo(t){t.addEventListener("message",({data:e})=>{if(this.isSceneSetting(e))this.tracer.scene=e.scene,t.postMessage(null);else if(this.isCameraSetting(e))this.tracer.scene.camera=e.camera,t.postMessage(null);else if(this.isRectTrace(e)){const r={x:e.rect.x,y:e.rect.y},n=new ImageData(new Uint8ClampedArray(4*e.rect.w*e.rect.h),e.rect.w,e.rect.h),s=new f(n);for(let t=r.y;t<r.y+n.height;t++)for(let e=r.x;e<r.x+n.width;e++)s.append(this.tracer.tracePoint(e,t));t.postMessage({position:r,image:n},[n.data.buffer])}})}isRectTrace(t){return"object"==typeof t&&t.hasOwnProperty("rect")}isSceneSetting(t){return"object"==typeof t&&t.hasOwnProperty("scene")}isCameraSetting(t){return"object"==typeof t&&t.hasOwnProperty("camera")}}).attachTo({postMessage:postMessage.bind(void 0),addEventListener:addEventListener.bind(void 0)})}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL3RyYWNlci92ZWN0b3IudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3RyYWNlci9jb2xvci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvdHJhY2VyL3NwaGVyZS50cyIsIndlYnBhY2s6Ly8vLi9zcmMvdHJhY2VyL3BsYW5lLnRzIiwid2VicGFjazovLy8uL3NyYy90cmFjZXIvYm9keS50cyIsIndlYnBhY2s6Ly8vLi9zcmMvdXRpbC9mdW5jdGlvbmFsLnRzIiwid2VicGFjazovLy8uL3NyYy90cmFjZXIvc3VyZmFjZS50cyIsIndlYnBhY2s6Ly8vLi9zcmMvdHJhY2VyL3JheS10cmFjZXIudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3dvcmtlci9pbWFnZS1kYXRhLWZpbGxlci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvd29ya2VyLnRzIiwid2VicGFjazovLy8uL3NyYy93b3JrZXIvd29ya2VyLWV4ZWN1dG9yLnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiX193ZWJwYWNrX2V4cG9ydHNfXyIsInRpbWVzIiwibWludXMiLCJwbHVzIiwiZG90IiwibWFnIiwibm9ybSIsImNyb3NzIiwiayIsInYiLCJ4IiwieSIsInoiLCJ2MSIsInYyIiwiTWF0aCIsInNxcnQiLCJ2bWFnIiwiSW5maW5pdHkiLCJ3aGl0ZSIsImdyZXkiLCJibGFjayIsImJhY2tncm91bmQiLCJkZWZhdWx0Q29sb3IiLCJzY2FsZSIsInRvRHJhd2luZ0NvbG9yIiwiZnJvbUhleCIsImciLCJiIiwiZmxvb3IiLCJtaW4iLCJoZXgiLCJudW0iLCJmcm9tTnVtYmVyIiwicGFyc2VJbnQiLCJtYWtlU3BoZXJlIiwic3BoZXJlSGFuZGxlciIsIl92ZWN0b3JfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfXyIsImNlbnRlciIsInJhZGl1cyIsInN1cmZhY2VJZCIsImhhbmRsZXJJZCIsInJhZGl1czIiLCJwb3ciLCJbb2JqZWN0IE9iamVjdF0iLCJyYXkiLCJzcGhlcmUiLCJlbyIsInN0YXJ0IiwiZGlyIiwiZGlzdCIsImRpc2MiLCJib2R5Iiwibm9ybWFsIiwicG9zIiwibWFrZVBsYW5lIiwicGxhbmVIYW5kbGVyIiwib2Zmc2V0IiwicGxhbmUiLCJkZW5vbSIsIl9wb3MiLCJyZWdpc3RyeSIsImFsd2F5cyIsInN1cmZhY2VfcmVnaXN0cnkiLCJzaGlueSIsImRpZmZ1c2UiLCJjb2xvciIsInNwZWN1bGFyIiwicmVmbGVjdCIsInJvdWdobmVzcyIsIm1hdHQiLCJjaGVja2VyYm9hcmQiLCJyYXlfdHJhY2VyX1JheVRyYWNlciIsInRoaXMiLCJtYXhEZXB0aCIsInN1cmZhY2VzIiwiYm9kaWVzIiwidHJhY2VSYXkiLCJzY2VuZSIsImNhbWVyYSIsImdldFBvaW50IiwidmVjdG9yIiwiZm9yd2FyZCIsIndpZHRoIiwicmlnaHQiLCJoZWlnaHQiLCJ1cCIsIm1hcCIsImludGVyc2VjdCIsInJlZHVjZSIsImNsb3Nlc3QiLCJpbnRlciIsImlzZWN0IiwiaW50ZXJzZWN0aW9ucyIsImRlcHRoIiwic2hhZGUiLCJyZWZsZWN0RGlyIiwibmF0dXJhbENvbG9yIiwiZ2V0TmF0dXJhbENvbG9yIiwicmVmbGVjdGVkQ29sb3IiLCJnZXRSZWZsZWN0aW9uQ29sb3IiLCJyZCIsImxpZ2h0cyIsImNvbCIsImxpZ2h0IiwibGRpcyIsImxpdmVjIiwibmVhdElzZWN0IiwidGVzdFJheSIsImlsbHVtIiwibGNvbG9yIiwic2NvbG9yIiwiSW1hZ2VEYXRhRmlsbGVyIiwiaW1hZ2VEYXRhIiwicG9pbnRlciIsImRhdGEiLCJ0cmFjZXIiLCJjb250ZXh0IiwiYWRkRXZlbnRMaXN0ZW5lciIsImlzU2NlbmVTZXR0aW5nIiwicG9zdE1lc3NhZ2UiLCJpc0NhbWVyYVNldHRpbmciLCJpc1JlY3RUcmFjZSIsInBvc2l0aW9uIiwicmVjdCIsImltYWdlIiwiSW1hZ2VEYXRhIiwiVWludDhDbGFtcGVkQXJyYXkiLCJ3IiwiaCIsImZpbGxlciIsImFwcGVuZCIsInRyYWNlUG9pbnQiLCJidWZmZXIiLCJhdHRhY2hUbyIsInVuZGVmaW5lZCJdLCJtYXBwaW5ncyI6ImFBQ0EsSUFBQUEsRUFBQSxHQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYsRUFBQUUsR0FDQSxPQUFBRixFQUFBRSxHQUFBQyxRQUdBLElBQUFDLEVBQUFKLEVBQUFFLEdBQUEsQ0FDQUcsRUFBQUgsRUFDQUksR0FBQSxFQUNBSCxRQUFBLElBVUEsT0FOQUksRUFBQUwsR0FBQU0sS0FBQUosRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUYsR0FHQUcsRUFBQUUsR0FBQSxFQUdBRixFQUFBRCxRQUtBRixFQUFBUSxFQUFBRixFQUdBTixFQUFBUyxFQUFBVixFQUdBQyxFQUFBVSxFQUFBLFNBQUFSLEVBQUFTLEVBQUFDLEdBQ0FaLEVBQUFhLEVBQUFYLEVBQUFTLElBQ0FHLE9BQUFDLGVBQUFiLEVBQUFTLEVBQUEsQ0FBMENLLFlBQUEsRUFBQUMsSUFBQUwsS0FLMUNaLEVBQUFrQixFQUFBLFNBQUFoQixHQUNBLG9CQUFBaUIsZUFBQUMsYUFDQU4sT0FBQUMsZUFBQWIsRUFBQWlCLE9BQUFDLFlBQUEsQ0FBd0RDLE1BQUEsV0FFeERQLE9BQUFDLGVBQUFiLEVBQUEsY0FBaURtQixPQUFBLEtBUWpEckIsRUFBQXNCLEVBQUEsU0FBQUQsRUFBQUUsR0FFQSxHQURBLEVBQUFBLElBQUFGLEVBQUFyQixFQUFBcUIsSUFDQSxFQUFBRSxFQUFBLE9BQUFGLEVBQ0EsS0FBQUUsR0FBQSxpQkFBQUYsUUFBQUcsV0FBQSxPQUFBSCxFQUNBLElBQUFJLEVBQUFYLE9BQUFZLE9BQUEsTUFHQSxHQUZBMUIsRUFBQWtCLEVBQUFPLEdBQ0FYLE9BQUFDLGVBQUFVLEVBQUEsV0FBeUNULFlBQUEsRUFBQUssVUFDekMsRUFBQUUsR0FBQSxpQkFBQUYsRUFBQSxRQUFBTSxLQUFBTixFQUFBckIsRUFBQVUsRUFBQWUsRUFBQUUsRUFBQSxTQUFBQSxHQUFnSCxPQUFBTixFQUFBTSxJQUFxQkMsS0FBQSxLQUFBRCxJQUNySSxPQUFBRixHQUlBekIsRUFBQTZCLEVBQUEsU0FBQTFCLEdBQ0EsSUFBQVMsRUFBQVQsS0FBQXFCLFdBQ0EsV0FBMkIsT0FBQXJCLEVBQUEsU0FDM0IsV0FBaUMsT0FBQUEsR0FFakMsT0FEQUgsRUFBQVUsRUFBQUUsRUFBQSxJQUFBQSxHQUNBQSxHQUlBWixFQUFBYSxFQUFBLFNBQUFpQixFQUFBQyxHQUFzRCxPQUFBakIsT0FBQWtCLFVBQUFDLGVBQUExQixLQUFBdUIsRUFBQUMsSUFHdEQvQixFQUFBa0MsRUFBQSxHQUlBbEMsSUFBQW1DLEVBQUEsa0NDbEZBbkMsRUFBQVUsRUFBQTBCLEVBQUEsc0JBQUFDLElBQUFyQyxFQUFBVSxFQUFBMEIsRUFBQSxzQkFBQUUsSUFBQXRDLEVBQUFVLEVBQUEwQixFQUFBLHNCQUFBRyxJQUFBdkMsRUFBQVUsRUFBQTBCLEVBQUEsc0JBQUFJLElBQUF4QyxFQUFBVSxFQUFBMEIsRUFBQSxzQkFBQUssSUFBQXpDLEVBQUFVLEVBQUEwQixFQUFBLHNCQUFBTSxJQUFBMUMsRUFBQVUsRUFBQTBCLEVBQUEsc0JBQUFPLElBQU8sTUFBQU4sRUFBQSxDQUFBTyxFQUFBQyxLQUFBLENBQ1BDLEVBQUFGLEVBQUFDLEVBQUFDLEVBQ0FDLEVBQUFILEVBQUFDLEVBQUFFLEVBQ0FDLEVBQUFKLEVBQUFDLEVBQUFHLElBRU9WLEVBQUEsQ0FBQVcsRUFBQUMsS0FBQSxDQUNQSixFQUFBRyxFQUFBSCxFQUFBSSxFQUFBSixFQUNBQyxFQUFBRSxFQUFBRixFQUFBRyxFQUFBSCxFQUNBQyxFQUFBQyxFQUFBRCxFQUFBRSxFQUFBRixJQUVPVCxFQUFBLENBQUFVLEVBQUFDLEtBQUEsQ0FDUEosRUFBQUcsRUFBQUgsRUFBQUksRUFBQUosRUFDQUMsRUFBQUUsRUFBQUYsRUFBQUcsRUFBQUgsRUFDQUMsRUFBQUMsRUFBQUQsRUFBQUUsRUFBQUYsSUFFT1IsRUFBQSxDQUFBUyxFQUFBQyxJQUFBRCxFQUFBSCxFQUFBSSxFQUFBSixFQUFBRyxFQUFBRixFQUFBRyxFQUFBSCxFQUFBRSxFQUFBRCxFQUFBRSxFQUFBRixFQUNBUCxFQUFBSSxHQUFBTSxLQUFBQyxLQUFBUCxFQUFBQyxFQUFBRCxFQUFBQyxFQUFBRCxFQUFBRSxFQUFBRixFQUFBRSxFQUFBRixFQUFBRyxFQUFBSCxFQUFBRyxHQUNBTixFQUFBRyxJQUNQLE1BQUFRLEVBQUFaLEVBQUFJLEdBQ0EsT0FBQVIsRUFBQSxJQUFBZ0IsRUFBQUMsSUFBQSxFQUFBRCxFQUFBUixJQUVPRixFQUFBLENBQUFNLEVBQUFDLEtBQUEsQ0FDUEosRUFBQUcsRUFBQUYsRUFBQUcsRUFBQUYsRUFBQUMsRUFBQUQsRUFBQUUsRUFBQUgsRUFDQUEsRUFBQUUsRUFBQUQsRUFBQUUsRUFBQUosRUFBQUcsRUFBQUgsRUFBQUksRUFBQUYsRUFDQUEsRUFBQUMsRUFBQUgsRUFBQUksRUFBQUgsRUFBQUUsRUFBQUYsRUFBQUcsRUFBQUosa0NDeEJBOUMsRUFBQVUsRUFBQTBCLEVBQUEsc0JBQUFtQixJQUFBdkQsRUFBQVUsRUFBQTBCLEVBQUEsc0JBQUFvQixJQUFBeEQsRUFBQVUsRUFBQTBCLEVBQUEsc0JBQUFxQixJQUFBekQsRUFBQVUsRUFBQTBCLEVBQUEsc0JBQUFzQixJQUFBMUQsRUFBQVUsRUFBQTBCLEVBQUEsc0JBQUF1QixJQUFBM0QsRUFBQVUsRUFBQTBCLEVBQUEsc0JBQUF3QixJQUFBNUQsRUFBQVUs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QWtILEVBQUEsSUFBQUMsVUFBQSxJQUFBQyxrQkFBQSxFQUFBWixFQUFBUyxLQUFBSSxFQUFBYixFQUFBUyxLQUFBSyxHQUFBZCxFQUFBUyxLQUFBSSxFQUFBYixFQUFBUyxLQUFBSyxHQUNBQyxFQUFBLElBQW1DbEIsRUFBZWEsR0FDbEQsUUFBQWxILEVBQUFnSCxFQUFBaEgsRUFBd0NBLEVBQUFnSCxFQUFBaEgsRUFBQWtILEVBQUF4QyxPQUErQjFFLElBQ3ZFLFFBQUFELEVBQUFpSCxFQUFBakgsRUFBNENBLEVBQUFpSCxFQUFBakgsRUFBQW1ILEVBQUExQyxNQUE4QnpFLElBQzFFd0gsRUFBQUMsT0FBQTFELEtBQUEyQyxPQUFBZ0IsV0FBQTFILEVBQUFDLElBR0EwRyxFQUFBRyxZQUFBLENBQ0FHLFdBQ0FFLFNBQ2lCLENBQUFBLEVBQUFWLEtBQUFrQixZQUlqQnpGLFlBQUF1RSxHQUNBLHVCQUFBQSxLQUFBdEgsZUFBQSxRQUVBK0MsZUFBQXVFLEdBQ0EsdUJBQUFBLEtBQUF0SCxlQUFBLFNBRUErQyxnQkFBQXVFLEdBQ0EsdUJBQUFBLEtBQUF0SCxlQUFBLGFEeENBeUksU0FBQSxDQUNBZCx3QkFBQWhJLFVBQWtDK0ksR0FDbENqQixrQ0FBQTlILFVBQTRDK0kiLCJmaWxlIjoid29ya2VyLmJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSA0KTtcbiIsImV4cG9ydCBjb25zdCB0aW1lcyA9IChrLCB2KSA9PiAoe1xuICAgIHg6IGsgKiB2LngsXG4gICAgeTogayAqIHYueSxcbiAgICB6OiBrICogdi56LFxufSk7XG5leHBvcnQgY29uc3QgbWludXMgPSAodjEsIHYyKSA9PiAoe1xuICAgIHg6IHYxLnggLSB2Mi54LFxuICAgIHk6IHYxLnkgLSB2Mi55LFxuICAgIHo6IHYxLnogLSB2Mi56LFxufSk7XG5leHBvcnQgY29uc3QgcGx1cyA9ICh2MSwgdjIpID0+ICh7XG4gICAgeDogdjEueCArIHYyLngsXG4gICAgeTogdjEueSArIHYyLnksXG4gICAgejogdjEueiArIHYyLnosXG59KTtcbmV4cG9ydCBjb25zdCBkb3QgPSAodjEsIHYyKSA9PiB2MS54ICogdjIueCArIHYxLnkgKiB2Mi55ICsgdjEueiAqIHYyLno7XG5leHBvcnQgY29uc3QgbWFnID0gKHYpID0+IE1hdGguc3FydCh2LnggKiB2LnggKyB2LnkgKiB2LnkgKyB2LnogKiB2LnopO1xuZXhwb3J0IGNvbnN0IG5vcm0gPSAodikgPT4ge1xuICAgIGNvbnN0IHZtYWcgPSBtYWcodik7XG4gICAgcmV0dXJuIHRpbWVzKCh2bWFnID09PSAwKSA/IEluZmluaXR5IDogMS4wIC8gdm1hZywgdik7XG59O1xuZXhwb3J0IGNvbnN0IGNyb3NzID0gKHYxLCB2MikgPT4gKHtcbiAgICB4OiB2MS55ICogdjIueiAtIHYxLnogKiB2Mi55LFxuICAgIHk6IHYxLnogKiB2Mi54IC0gdjEueCAqIHYyLnosXG4gICAgejogdjEueCAqIHYyLnkgLSB2MS55ICogdjIueCxcbn0pO1xuIiwiZXhwb3J0IGNvbnN0IHdoaXRlID0geyByOiAxLjAsIGc6IDEuMCwgYjogMS4wIH07XG5leHBvcnQgY29uc3QgZ3JleSA9IHsgcjogMC41LCBnOiAwLjUsIGI6IDAuNSB9O1xuZXhwb3J0IGNvbnN0IGJsYWNrID0geyByOiAwLjAsIGc6IDAuMCwgYjogMC4wIH07XG5leHBvcnQgY29uc3QgYmFja2dyb3VuZCA9IGJsYWNrO1xuZXhwb3J0IGNvbnN0IGRlZmF1bHRDb2xvciA9IGJsYWNrO1xuZXhwb3J0IGNvbnN0IHNjYWxlID0gKGssIHYpID0+ICh7IHI6IGsgKiB2LnIsIGc6IGsgKiB2LmcsIGI6IGsgKiB2LmIgfSk7XG5leHBvcnQgY29uc3QgcGx1cyA9ICh2MSwgdjIpID0+ICh7IHI6IHYxLnIgKyB2Mi5yLCBnOiB2MS5nICsgdjIuZywgYjogdjEuYiArIHYyLmIgfSk7XG5leHBvcnQgY29uc3QgdGltZXMgPSAodjEsIHYyKSA9PiAoeyByOiB2MS5yICogdjIuciwgZzogdjEuZyAqIHYyLmcsIGI6IHYxLmIgKiB2Mi5iIH0pO1xuZXhwb3J0IGNvbnN0IHRvRHJhd2luZ0NvbG9yID0gKGMpID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgICByOiBNYXRoLmZsb29yKE1hdGgubWluKDEsIGMucikgKiAyNTUpLFxuICAgICAgICBnOiBNYXRoLmZsb29yKE1hdGgubWluKDEsIGMuZykgKiAyNTUpLFxuICAgICAgICBiOiBNYXRoLmZsb29yKE1hdGgubWluKDEsIGMuYikgKiAyNTUpLFxuICAgIH07XG59O1xuZXhwb3J0IGNvbnN0IHRvU3RyaW5nID0gKGMpID0+IGByZ2IoJHtjLnJ9LCAke2MuZ30sICR7Yy5ifWA7XG5leHBvcnQgY29uc3QgZnJvbU51bWJlciA9IChudW0pID0+ICh7XG4gICAgcjogKChudW0gPj4gMTYpICYgMjU1KSAvIDI1NSxcbiAgICBnOiAoKG51bSA+PiA4KSAmIDI1NSkgLyAyNTUsXG4gICAgYjogKG51bSAmIDI1NSkgLyAyNTUsXG59KTtcbmV4cG9ydCBjb25zdCBmcm9tSGV4ID0gKGhleCkgPT4gZnJvbU51bWJlcihwYXJzZUludChoZXgsIDE2KSk7XG4iLCJpbXBvcnQgeyBkb3QsIG1pbnVzLCBub3JtIH0gZnJvbSAnLi92ZWN0b3InO1xuZXhwb3J0IGNvbnN0IG1ha2VTcGhlcmUgPSAoY2VudGVyLCByYWRpdXMsIHN1cmZhY2VJZCkgPT4gKHtcbiAgICBoYW5kbGVySWQ6ICdzcGhlcmUnLFxuICAgIHN1cmZhY2VJZCxcbiAgICBjZW50ZXIsXG4gICAgcmFkaXVzMjogTWF0aC5wb3cocmFkaXVzLCAyKSxcbn0pO1xuZXhwb3J0IGNvbnN0IHNwaGVyZUhhbmRsZXIgPSB7XG4gICAgaW50ZXJzZWN0KHJheSwgc3BoZXJlKSB7XG4gICAgICAgIGNvbnN0IGVvID0gbWludXMoc3BoZXJlLmNlbnRlciwgcmF5LnN0YXJ0KTtcbiAgICAgICAgY29uc3QgdiA9IGRvdChlbywgcmF5LmRpcik7XG4gICAgICAgIGxldCBkaXN0ID0gMDtcbiAgICAgICAgaWYgKHYgPj0gMCkge1xuICAgICAgICAgICAgY29uc3QgZGlzYyA9IHNwaGVyZS5yYWRpdXMyIC0gKGRvdChlbywgZW8pIC0gdiAqIHYpO1xuICAgICAgICAgICAgaWYgKGRpc2MgPj0gMCkge1xuICAgICAgICAgICAgICAgIGRpc3QgPSB2IC0gTWF0aC5zcXJ0KGRpc2MpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkaXN0ICE9PSAwID8geyBib2R5OiBzcGhlcmUsIHJheSwgZGlzdCB9IDogbnVsbDtcbiAgICB9LFxuICAgIG5vcm1hbDogKHBvcywgc3BoZXJlKSA9PiBub3JtKG1pbnVzKHBvcywgc3BoZXJlLmNlbnRlcikpLFxufTtcbiIsImltcG9ydCB7IGRvdCB9IGZyb20gJy4vdmVjdG9yJztcbmV4cG9ydCBjb25zdCBtYWtlUGxhbmUgPSAobm9ybSwgb2Zmc2V0LCBzdXJmYWNlSWQpID0+ICh7XG4gICAgaGFuZGxlcklkOiAncGxhbmUnLFxuICAgIHN1cmZhY2VJZCxcbiAgICBub3JtLFxuICAgIG9mZnNldCxcbn0pO1xuZXhwb3J0IGNvbnN0IHBsYW5lSGFuZGxlciA9IHtcbiAgICBpbnRlcnNlY3QocmF5LCBwbGFuZSkge1xuICAgICAgICBjb25zdCBkZW5vbSA9IGRvdChwbGFuZS5ub3JtLCByYXkuZGlyKTtcbiAgICAgICAgaWYgKGRlbm9tID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBkaXN0ID0gKGRvdChwbGFuZS5ub3JtLCByYXkuc3RhcnQpICsgcGxhbmUub2Zmc2V0KSAvICgtZGVub20pO1xuICAgICAgICAgICAgcmV0dXJuIHsgYm9keTogcGxhbmUsIHJheSwgZGlzdCB9O1xuICAgICAgICB9XG4gICAgfSxcbiAgICBub3JtYWw6IChfcG9zLCBwbGFuZSkgPT4gcGxhbmUubm9ybSxcbn07XG4iLCJpbXBvcnQgeyBwbGFuZUhhbmRsZXIgfSBmcm9tICcuL3BsYW5lJztcbmltcG9ydCB7IHNwaGVyZUhhbmRsZXIgfSBmcm9tICcuL3NwaGVyZSc7XG5leHBvcnQgY29uc3QgcmVnaXN0cnkgPSB7XG4gICAgcGxhbmU6IHBsYW5lSGFuZGxlcixcbiAgICBzcGhlcmU6IHNwaGVyZUhhbmRsZXIsXG59O1xuIiwiZXhwb3J0IGNvbnN0IGFsd2F5cyA9ICh2YWx1ZSkgPT4gKCkgPT4gdmFsdWU7XG4iLCJpbXBvcnQgeyBhbHdheXMgfSBmcm9tICcuLi91dGlsL2Z1bmN0aW9uYWwnO1xuaW1wb3J0IHsgYmxhY2ssIGdyZXksIHdoaXRlIH0gZnJvbSAnLi9jb2xvcic7XG5leHBvcnQgY29uc3Qgc2hpbnkgPSB7XG4gICAgZGlmZnVzZTogYWx3YXlzKHdoaXRlKSxcbiAgICBzcGVjdWxhcjogYWx3YXlzKGdyZXkpLFxuICAgIHJlZmxlY3Q6IGFsd2F5cygwLjcpLFxuICAgIHJvdWdobmVzczogMjUwLFxufTtcbmV4cG9ydCBjb25zdCBtYXR0ID0ge1xuICAgIGRpZmZ1c2U6IGFsd2F5cyh3aGl0ZSksXG4gICAgc3BlY3VsYXI6IGFsd2F5cyhibGFjayksXG4gICAgcmVmbGVjdDogYWx3YXlzKDAuMDEpLFxuICAgIHJvdWdobmVzczogOTAwLFxufTtcbmV4cG9ydCBjb25zdCBjaGVja2VyYm9hcmQgPSB7XG4gICAgZGlmZnVzZTogcG9zID0+ICgoTWF0aC5mbG9vcihwb3MueikgKyBNYXRoLmZsb29yKHBvcy54KSkgJSAyICE9PSAwKSA/IHdoaXRlIDogYmxhY2ssXG4gICAgc3BlY3VsYXI6IGFsd2F5cyh3aGl0ZSksXG4gICAgcmVmbGVjdDogcG9zID0+ICgoTWF0aC5mbG9vcihwb3MueikgKyBNYXRoLmZsb29yKHBvcy54KSkgJSAyICE9PSAwKSA/IDAuMSA6IDAuNyxcbiAgICByb3VnaG5lc3M6IDE1MCxcbn07XG5leHBvcnQgY29uc3QgcmVnaXN0cnkgPSB7XG4gICAgc2hpbnksXG4gICAgbWF0dCxcbiAgICBjaGVja2VyYm9hcmQsXG59O1xuIiwiaW1wb3J0IHsgcmVnaXN0cnkgYXMgYm9keVJlZ2lzdHJ5IH0gZnJvbSAnLi9ib2R5JztcbmltcG9ydCAqIGFzIGMgZnJvbSAnLi9jb2xvcic7XG5pbXBvcnQgeyByZWdpc3RyeSBhcyBzdXJmYWNlUmVnaXN0cnkgfSBmcm9tICcuL3N1cmZhY2UnO1xuaW1wb3J0IHsgZG90LCBtYWcsIG1pbnVzLCBub3JtLCBwbHVzLCB0aW1lcyB9IGZyb20gJy4vdmVjdG9yJztcbmV4cG9ydCBjbGFzcyBSYXlUcmFjZXIge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLm1heERlcHRoID0gNTtcbiAgICAgICAgdGhpcy5zdXJmYWNlcyA9IHN1cmZhY2VSZWdpc3RyeTtcbiAgICAgICAgdGhpcy5ib2RpZXMgPSBib2R5UmVnaXN0cnk7XG4gICAgfVxuICAgIHRyYWNlUG9pbnQoeCwgeSkge1xuICAgICAgICByZXR1cm4gYy50b0RyYXdpbmdDb2xvcih0aGlzLnRyYWNlUmF5KHtcbiAgICAgICAgICAgIHN0YXJ0OiB0aGlzLnNjZW5lLmNhbWVyYS5wb3MsXG4gICAgICAgICAgICBkaXI6IHRoaXMuZ2V0UG9pbnQoeCwgeSksXG4gICAgICAgIH0sIDApKTtcbiAgICB9XG4gICAgZ2V0UG9pbnQoeCwgeSkge1xuICAgICAgICByZXR1cm4gbm9ybShwbHVzKHRoaXMuc2NlbmUuY2FtZXJhLmZvcndhcmQsIHBsdXModGltZXMoKHggLSAodGhpcy5zY2VuZS5jYW1lcmEud2lkdGggLyAyLjApKSAvIDIuMCAvIHRoaXMuc2NlbmUuY2FtZXJhLndpZHRoLCB0aGlzLnNjZW5lLmNhbWVyYS5yaWdodCksIHRpbWVzKC0oeSAtICh0aGlzLnNjZW5lLmNhbWVyYS5oZWlnaHQgLyAyLjApKSAvIDIuMCAvIHRoaXMuc2NlbmUuY2FtZXJhLmhlaWdodCwgdGhpcy5zY2VuZS5jYW1lcmEudXApKSkpO1xuICAgIH1cbiAgICBpbnRlcnNlY3Rpb25zKHJheSkge1xuICAgICAgICByZXR1cm4gdGhpcy5zY2VuZS5ib2RpZXNcbiAgICAgICAgICAgIC5tYXAoYm9keSA9PiB0aGlzLmJvZGllc1tib2R5LmhhbmRsZXJJZF0uaW50ZXJzZWN0KHJheSwgYm9keSkpXG4gICAgICAgICAgICAucmVkdWNlKChjbG9zZXN0LCBpbnRlcikgPT4gKCFjbG9zZXN0IHx8IGludGVyICYmIGludGVyLmRpc3QgPCBjbG9zZXN0LmRpc3QpID8gaW50ZXIgOiBjbG9zZXN0LCBudWxsKTtcbiAgICAgICAgLy8gbGV0IGNsb3Nlc3Q6IEludGVyc2VjdGlvbjtcbiAgICAgICAgLy8gZm9yIChjb25zdCBib2R5IG9mIHRoaXMuc2NlbmUuYm9kaWVzKSB7XG4gICAgICAgIC8vICAgICBjb25zdCBpbnRlciA9ICh0aGlzLmJvZGllc1tib2R5LmhhbmRsZXJJZF0gYXMgQm9keUhhbmRsZXIpLmludGVyc2VjdChyYXksIGJvZHkpO1xuICAgICAgICAvLyAgICAgaWYgKCFjbG9zZXN0IHx8IChpbnRlciAmJiBpbnRlci5kaXN0IDwgY2xvc2VzdC5kaXN0KSkge1xuICAgICAgICAvLyAgICAgICAgIGNsb3Nlc3QgPSBpbnRlcjtcbiAgICAgICAgLy8gICAgIH1cbiAgICAgICAgLy8gfVxuICAgICAgICAvLyByZXR1cm4gY2xvc2VzdDtcbiAgICB9XG4gICAgdGVzdFJheShyYXkpIHtcbiAgICAgICAgY29uc3QgaXNlY3QgPSB0aGlzLmludGVyc2VjdGlvbnMocmF5KTtcbiAgICAgICAgcmV0dXJuIGlzZWN0ID8gaXNlY3QuZGlzdCA6IG51bGw7XG4gICAgfVxuICAgIHRyYWNlUmF5KHJheSwgZGVwdGgpIHtcbiAgICAgICAgY29uc3QgaXNlY3QgPSB0aGlzLmludGVyc2VjdGlvbnMocmF5KTtcbiAgICAgICAgcmV0dXJuIGlzZWN0ID8gdGhpcy5zaGFkZShpc2VjdCwgZGVwdGgpIDogYy5iYWNrZ3JvdW5kO1xuICAgIH1cbiAgICBzaGFkZShpc2VjdCwgZGVwdGgpIHtcbiAgICAgICAgY29uc3QgZCA9IGlzZWN0LnJheS5kaXI7XG4gICAgICAgIGNvbnN0IHBvcyA9IHBsdXModGltZXMoaXNlY3QuZGlzdCwgZCksIGlzZWN0LnJheS5zdGFydCk7XG4gICAgICAgIGNvbnN0IGJvZHlIYW5kbGVyID0gdGhpcy5ib2RpZXNbaXNlY3QuYm9keS5oYW5kbGVySWRdO1xuICAgICAgICBjb25zdCBub3JtYWwgPSBib2R5SGFuZGxlci5ub3JtYWwocG9zLCBpc2VjdC5ib2R5KTtcbiAgICAgICAgY29uc3QgcmVmbGVjdERpciA9IG1pbnVzKGQsIHRpbWVzKDIsIHRpbWVzKGRvdChub3JtYWwsIGQpLCBub3JtYWwpKSk7XG4gICAgICAgIGNvbnN0IG5hdHVyYWxDb2xvciA9IGMucGx1cyhjLmJhY2tncm91bmQsIHRoaXMuZ2V0TmF0dXJhbENvbG9yKGlzZWN0LmJvZHksIHBvcywgbm9ybWFsLCByZWZsZWN0RGlyKSk7XG4gICAgICAgIGNvbnN0IHJlZmxlY3RlZENvbG9yID0gKGRlcHRoID49IHRoaXMubWF4RGVwdGgpXG4gICAgICAgICAgICA/IGMuZ3JleVxuICAgICAgICAgICAgOiB0aGlzLmdldFJlZmxlY3Rpb25Db2xvcihpc2VjdC5ib2R5LCBwb3MsIHJlZmxlY3REaXIsIGRlcHRoKTtcbiAgICAgICAgcmV0dXJuIGMucGx1cyhuYXR1cmFsQ29sb3IsIHJlZmxlY3RlZENvbG9yKTtcbiAgICB9XG4gICAgZ2V0UmVmbGVjdGlvbkNvbG9yKGJvZHksIHBvcywgcmQsIGRlcHRoKSB7XG4gICAgICAgIHJldHVybiBjLnNjYWxlKHRoaXMuc3VyZmFjZXNbYm9keS5zdXJmYWNlSWRdLnJlZmxlY3QocG9zKSwgdGhpcy50cmFjZVJheSh7IHN0YXJ0OiBwb3MsIGRpcjogcmQgfSwgZGVwdGggKyAxKSk7XG4gICAgfVxuICAgIGdldE5hdHVyYWxDb2xvcihib2R5LCBwb3MsIG5vcm1hbCwgcmQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2NlbmUubGlnaHRzLnJlZHVjZSgoY29sLCBsaWdodCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbGRpcyA9IG1pbnVzKGxpZ2h0LnBvcywgcG9zKTtcbiAgICAgICAgICAgIGNvbnN0IGxpdmVjID0gbm9ybShsZGlzKTtcbiAgICAgICAgICAgIGNvbnN0IG5lYXRJc2VjdCA9IHRoaXMudGVzdFJheSh7IHN0YXJ0OiBwb3MsIGRpcjogbGl2ZWMgfSk7XG4gICAgICAgICAgICBjb25zdCBpc0luU2hhZG93ID0gIW5lYXRJc2VjdCA/IGZhbHNlIDogKG5lYXRJc2VjdCA8PSBtYWcobGRpcykpO1xuICAgICAgICAgICAgaWYgKGlzSW5TaGFkb3cpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29sO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaWxsdW0gPSBkb3QobGl2ZWMsIG5vcm1hbCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbGNvbG9yID0gKGlsbHVtID4gMCkgPyBjLnNjYWxlKGlsbHVtLCBsaWdodC5jb2xvcilcbiAgICAgICAgICAgICAgICAgICAgOiBjLmRlZmF1bHRDb2xvcjtcbiAgICAgICAgICAgICAgICBjb25zdCBzcGVjdWxhciA9IGRvdChsaXZlYywgbm9ybShyZCkpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNjb2xvciA9IChzcGVjdWxhciA+IDApXG4gICAgICAgICAgICAgICAgICAgID8gYy5zY2FsZShNYXRoLnBvdyhzcGVjdWxhciwgdGhpcy5zdXJmYWNlc1tib2R5LnN1cmZhY2VJZF0ucm91Z2huZXNzKSwgbGlnaHQuY29sb3IpXG4gICAgICAgICAgICAgICAgICAgIDogYy5kZWZhdWx0Q29sb3I7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGMucGx1cyhjb2wsIGMucGx1cyhjLnRpbWVzKHRoaXMuc3VyZmFjZXNbYm9keS5zdXJmYWNlSWRdLmRpZmZ1c2UocG9zKSwgbGNvbG9yKSwgYy50aW1lcyh0aGlzLnN1cmZhY2VzW2JvZHkuc3VyZmFjZUlkXS5zcGVjdWxhcihwb3MpLCBzY29sb3IpKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGMuZGVmYXVsdENvbG9yKTtcbiAgICB9XG59XG4iLCJleHBvcnQgY2xhc3MgSW1hZ2VEYXRhRmlsbGVyIHtcbiAgICBjb25zdHJ1Y3RvcihpbWFnZURhdGEpIHtcbiAgICAgICAgdGhpcy5wb2ludGVyID0gMDtcbiAgICAgICAgdGhpcy5kYXRhID0gaW1hZ2VEYXRhLmRhdGE7XG4gICAgfVxuICAgIGFwcGVuZChjb2xvcikge1xuICAgICAgICB0aGlzLmRhdGFbdGhpcy5wb2ludGVyKytdID0gY29sb3IucjtcbiAgICAgICAgdGhpcy5kYXRhW3RoaXMucG9pbnRlcisrXSA9IGNvbG9yLmc7XG4gICAgICAgIHRoaXMuZGF0YVt0aGlzLnBvaW50ZXIrK10gPSBjb2xvci5iO1xuICAgICAgICB0aGlzLmRhdGFbdGhpcy5wb2ludGVyKytdID0gMjU1O1xuICAgIH1cbn1cbiIsImltcG9ydCB7IFdvcmtlckV4ZWN1dG9yIH0gZnJvbSAnLi93b3JrZXIvd29ya2VyLWV4ZWN1dG9yJztcbmNvbnN0IGV4ZWN1dG9yID0gbmV3IFdvcmtlckV4ZWN1dG9yKCk7XG5leGVjdXRvci5hdHRhY2hUbyh7XG4gICAgcG9zdE1lc3NhZ2U6IHBvc3RNZXNzYWdlLmJpbmQodGhpcyksXG4gICAgYWRkRXZlbnRMaXN0ZW5lcjogYWRkRXZlbnRMaXN0ZW5lci5iaW5kKHRoaXMpLFxufSk7XG4iLCJpbXBvcnQgeyBSYXlUcmFjZXIgfSBmcm9tICcuLi90cmFjZXIvcmF5LXRyYWNlcic7XG5pbXBvcnQgeyBJbWFnZURhdGFGaWxsZXIgfSBmcm9tICcuL2ltYWdlLWRhdGEtZmlsbGVyJztcbmV4cG9ydCBjbGFzcyBXb3JrZXJFeGVjdXRvciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMudHJhY2VyID0gbmV3IFJheVRyYWNlcigpO1xuICAgIH1cbiAgICBhdHRhY2hUbyhjb250ZXh0KSB7XG4gICAgICAgIGNvbnRleHQuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsICh7IGRhdGEgfSkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNTY2VuZVNldHRpbmcoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRyYWNlci5zY2VuZSA9IGRhdGEuc2NlbmU7XG4gICAgICAgICAgICAgICAgY29udGV4dC5wb3N0TWVzc2FnZShudWxsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuaXNDYW1lcmFTZXR0aW5nKGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50cmFjZXIuc2NlbmUuY2FtZXJhID0gZGF0YS5jYW1lcmE7XG4gICAgICAgICAgICAgICAgY29udGV4dC5wb3N0TWVzc2FnZShudWxsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuaXNSZWN0VHJhY2UoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBwb3NpdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgeDogZGF0YS5yZWN0LngsXG4gICAgICAgICAgICAgICAgICAgIHk6IGRhdGEucmVjdC55LFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY29uc3QgaW1hZ2UgPSBuZXcgSW1hZ2VEYXRhKG5ldyBVaW50OENsYW1wZWRBcnJheSg0ICogZGF0YS5yZWN0LncgKiBkYXRhLnJlY3QuaCksIGRhdGEucmVjdC53LCBkYXRhLnJlY3QuaCk7XG4gICAgICAgICAgICAgICAgY29uc3QgZmlsbGVyID0gbmV3IEltYWdlRGF0YUZpbGxlcihpbWFnZSk7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgeSA9IHBvc2l0aW9uLnk7IHkgPCBwb3NpdGlvbi55ICsgaW1hZ2UuaGVpZ2h0OyB5KyspIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IHBvc2l0aW9uLng7IHggPCBwb3NpdGlvbi54ICsgaW1hZ2Uud2lkdGg7IHgrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsbGVyLmFwcGVuZCh0aGlzLnRyYWNlci50cmFjZVBvaW50KHgsIHkpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb250ZXh0LnBvc3RNZXNzYWdlKHtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24sXG4gICAgICAgICAgICAgICAgICAgIGltYWdlLFxuICAgICAgICAgICAgICAgIH0sIFtpbWFnZS5kYXRhLmJ1ZmZlcl0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgaXNSZWN0VHJhY2UoZGF0YSkge1xuICAgICAgICByZXR1cm4gdHlwZW9mIGRhdGEgPT09ICdvYmplY3QnICYmIGRhdGEuaGFzT3duUHJvcGVydHkoJ3JlY3QnKTtcbiAgICB9XG4gICAgaXNTY2VuZVNldHRpbmcoZGF0YSkge1xuICAgICAgICByZXR1cm4gdHlwZW9mIGRhdGEgPT09ICdvYmplY3QnICYmIGRhdGEuaGFzT3duUHJvcGVydHkoJ3NjZW5lJyk7XG4gICAgfVxuICAgIGlzQ2FtZXJhU2V0dGluZyhkYXRhKSB7XG4gICAgICAgIHJldHVybiB0eXBlb2YgZGF0YSA9PT0gJ29iamVjdCcgJiYgZGF0YS5oYXNPd25Qcm9wZXJ0eSgnY2FtZXJhJyk7XG4gICAgfVxufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==